- name: Wait for Docker Compose deployment to complete
  ansible.builtin.async_status:
    jid: "{{ compose_deploy.ansible_job_id }}"  # Job ID of the async task
  register: job_result
  until: job_result.finished  # Wait until the job is finished
  retries: 30  # Maximum number of retries
  delay: 2     # Delay (in seconds) between retries


- name: Show docker-compose deployment result
  ansible.builtin.debug:
    var: job_result

          device: '${HOME}/data/wordpress_website'

 env:
      HOME: /home/{{ ansible_user }

       - name: Set ansible_user dynamically
      ansible.builtin.set_fact:
        ansible_user: "{{ ansible_user_id }}"


          - name: Bring down Docker Compose and remove volumes
      ansible.builtin.command:
        cmd: docker-compose down -v
        chdir: /path/to/your/docker-compose/directory

    - name: Remove unused Docker volumes
      ansible.builtin.command:
        cmd: docker volume prune -f


              when: "'down' in ansible_run_tags"
